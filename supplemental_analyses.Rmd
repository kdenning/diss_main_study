---
title: "Supplemental Analyses"
output: 
    html_document:
      code_download: TRUE
      toc: TRUE
      toc_float:
        collapsed: FALSE
      toc_depth: 1
      code_folding: hide
editor_options: 
  chunk_output_type: console
---

```{r data prep, echo = FALSE, warning = FALSE, message = FALSE, error = FALSE}
# Loading packages
library(psych)
library(effects)
library(magrittr) # part of the tidyverse but must be read in on its own
library(parameters)
library(dplyr)
library(tidyr)
library(rio)
library(ggplot2)
library(emmeans)
library(lavaan)

# Functions to clean document, get data from wide to long format
source("functions/Cleaning.R")

# Setting global chunk options
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)

options(scipen = 999)

# Importing data
wide_data <- import("data/diss_main_combined_data_basic_clean.csv")

# Cleaning data using functions
long_data_bfi <- get_wrangled_bfi(wide_data)
long_data_eli <- get_wrangled_eli(wide_data)

clean_vars_bfi <- get_vars_cleaned(long_data_bfi)
clean_vars_eli <- get_vars_cleaned(long_data_eli)

clean_data_bfi <- remove_participants(clean_vars_bfi)
clean_data_eli <- remove_participants(clean_vars_eli)

clean_data_bfi %<>%    
  mutate(itt_comp = rowMeans(select(., c("realistic_q", "symbolic_q"))),
         itt_comp_gmc = itt_comp - mean(itt_comp, na.rm = TRUE))

clean_data_eli %<>%    
  mutate(itt_comp = rowMeans(select(., c("realistic_q", "symbolic_q"))),
         itt_comp_gmc = scale(itt_comp, center = T, scale = F))
```

# Intervention checks {.tabset .tabset-fade .tabset-pills}

## How much did they take Jen's perspective?

```{r}
pt_check_df <- clean_data_bfi %>% 
  select(sub_id, analog_condition, intervention_check1, intervention_check2, intervention_check3) %>% 
  unique() %>% 
  mutate(intervention_check1 = as.numeric(dplyr::recode(intervention_check1, #how much did you take Jen's perspective
                                             `Completely` = "4",
                                             `Moderately` = "3",
                                             `Slightly` = "2",
                                             `Not at all` = "1")), 
         intervention_check2 = as.numeric(dplyr::recode(intervention_check2, # How misunderstood is Jen
                                             `Always` = "4",
                                             `Slightly` = "3",
                                             `Rarely` = "2",
                                             `Not at all` = "1")))

pt_check_df %>% 
  group_by(analog_condition) %>% 
  mutate(mean = mean(intervention_check1),
         sd = sd(intervention_check1)) %>% 
  select(analog_condition, mean, sd) %>% 
  unique()
```

```{r}
int_check1_res <- aov(intervention_check1 ~ analog_condition, data = pt_check_df)
anova(int_check1_res)
```

How much they reported taking her perspective was not significantly different

## How misunderstood was Jen?

```{r}
pt_check_df %>% 
  group_by(analog_condition) %>% 
  mutate(mean = mean(intervention_check2),
         sd = sd(intervention_check2)) %>% 
  select(analog_condition, mean, sd) %>% 
  unique()
```

```{r}
int_check2_res <- aov(intervention_check2 ~ analog_condition, data = pt_check_df)
anova(int_check2_res)
```

How much they reported Jen was misunderstood was significantly different, with those in the analog condition saying she was more misunderstood. However, this did not have an effect on counter-projection.

# Exploratory analyses including analog condition {.tabset .tabset-fade .tabset-pills}

## Targ condition x analog condition on threat

```{r}
mod2_data <- clean_data_bfi %>% 
  select(sub_id, itt_comp_gmc, analog_condition, target_condition) %>% 
  unique()
```

```{r}
mod2b <- lm(itt_comp ~ analog_condition*target_condition, data = mod2_data)
summary(mod2b)
```

## Analog x targ on projection

```{r}
bfi_data <- clean_data_bfi %>% 
  select(sub_id, bfi_number, bfi_targ_pmc, bfi_self_pmc, itt_comp_gmc,
         target_condition, bfi_targ, bfi_self, bfi_stereo, bfi_stereo_pmc,
         analog_condition) %>% 
  unique() %>% 
  na.omit() 
```

```{r}
mod3a_bfi <- lmer(bfi_targ ~ bfi_self_pmc*analog_condition*target_condition +
       (bfi_self_pmc| sub_id), data = bfi_data)
summary(mod3a_bfi)

tab_model(mod3a_bfi)
```

Analog does not appear to have an effect, so threat will have nothing to affect...

## Analog x threat composite on projection

```{r}
mod3b_bfi <- lmer(bfi_targ ~ bfi_self_pmc*analog_condition*itt_comp_gmc +
       (bfi_self_pmc| sub_id), data = bfi_data)
summary(mod3b_bfi)

tab_model(mod3b_bfi)
```

# Checking mean/sd of bfi_self responses per item {.tabset .tabset-fade .tabset-pills}

```{r}
bfi_wide_self <- clean_data %>% 
  select(sub_id, bfi_number, bfi_self) %>% 
  unique() %>% 
  pivot_wider(names_from = bfi_number, values_from = bfi_self) %>% 
  select(sub_id, "1":"19") %>% 
  unique()

psych::describe(bfi_wide_self)
```

# Variance around threat composite by threat condition {.tabset .tabset-fade .tabset-pills}

```{r}
clean_data_bfi %>% 
  select(sub_id, itt_comp_gmc, target_condition) %>% 
  group_by(target_condition) %>% 
  mutate(mean = mean(itt_comp_gmc),
         sd = sd(itt_comp_gmc)) %>% 
  select(target_condition, mean, sd) %>% 
  unique()
```

## Control condition only

```{r}
filter_control <- clean_data_bfi %>% 
  filter(target_condition == "CONTROL")

hist(filter_control$itt_comp)
```

## Warm condition only

```{r}
filter_warm <- clean_data_bfi %>% 
  filter(target_condition == "WARM")

hist(filter_warm$itt_comp)
```

## Political loss condition only

```{r}
filter_loss <- clean_data_bfi %>% 
  filter(target_condition == "LOSS")

hist(filter_loss$itt_comp)
```