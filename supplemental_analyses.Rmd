---
title: "Supplemental Analyses"
output: 
    html_document:
      code_download: TRUE
      toc: TRUE
      toc_float:
        collapsed: FALSE
      toc_depth: 1
      code_folding: hide
editor_options: 
  chunk_output_type: console
---

```{r data prep, echo = FALSE, warning = FALSE, message = FALSE, error = FALSE}
# Loading packages
library(psych)
library(effects)
library(magrittr) # part of the tidyverse but must be read in on its own
library(parameters)
library(dplyr)
library(tidyr)
library(rio)
library(ggplot2)
library(emmeans)
library(lavaan)

# Functions to clean document, get data from wide to long format
source("functions/Cleaning.R")

# Setting global chunk options
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      warning = FALSE)

options(scipen = 999)

# Importing data
wide_data <- import("data/diss_main_combined_data_basic_clean.csv")

# Cleaning data using functions
long_data_bfi <- get_wrangled_bfi(wide_data)
long_data_eli <- get_wrangled_eli(wide_data)

clean_vars_bfi <- get_vars_cleaned(long_data_bfi)
clean_vars_eli <- get_vars_cleaned(long_data_eli)

clean_data_bfi <- remove_participants(clean_vars_bfi)
clean_data_eli <- remove_participants(clean_vars_eli)

clean_data_bfi %<>%    
  mutate(itt_comp = rowMeans(select(., c("realistic_q", "symbolic_q"))),
         itt_comp_gmc = itt_comp - mean(itt_comp, na.rm = TRUE))

clean_data_eli %<>%    
  mutate(itt_comp = rowMeans(select(., c("realistic_q", "symbolic_q"))),
         itt_comp_gmc = scale(itt_comp, center = T, scale = F))
```

# Intervention checks {.tabset .tabset-fade .tabset-pills}

## How much did they take Jen's perspective?

```{r}
pt_check_df <- clean_data_bfi %>% 
  select(sub_id, analog_condition, intervention_check1, intervention_check2, intervention_check3) %>% 
  unique() %>% 
  mutate(intervention_check1 = as.numeric(dplyr::recode(intervention_check1, #how much did you take Jen's perspective
                                             `Completely` = "4",
                                             `Moderately` = "3",
                                             `Slightly` = "2",
                                             `Not at all` = "1")), 
         intervention_check2 = as.numeric(dplyr::recode(intervention_check2, # How misunderstood is Jen
                                             `Always` = "4",
                                             `Slightly` = "3",
                                             `Rarely` = "2",
                                             `Not at all` = "1")))

pt_check_df %>% 
  group_by(analog_condition) %>% 
  mutate(mean = mean(intervention_check1),
         sd = sd(intervention_check1)) %>% 
  select(analog_condition, mean, sd) %>% 
  unique()
```

```{r}
int_check1_res <- aov(intervention_check1 ~ analog_condition, data = pt_check_df)
anova(int_check1_res)
```

How much they reported taking her perspective was not significantly different

## How misunderstood was Jen?

```{r}
pt_check_df %>% 
  group_by(analog_condition) %>% 
  mutate(mean = mean(intervention_check2),
         sd = sd(intervention_check2)) %>% 
  select(analog_condition, mean, sd) %>% 
  unique()
```

```{r}
int_check2_res <- aov(intervention_check2 ~ analog_condition, data = pt_check_df)
anova(int_check2_res)
```

How much they reported Jen was misunderstood was significantly different, with those in the analog condition saying she was more misunderstood. However, this did not have an effect on counter-projection.

# Exploring relationship of ELI vars with politics {.tabset .tabset-fade .tabset-pills}

```{r}
eli_wide <- clean_data %>% 
  select(sub_id, eli_number, eli_self, pol_orient_1, pol_orient_2, pol_orient_3) %>% 
  unique() %>% 
  pivot_wider(names_from = eli_number, values_from = eli_self) %>% 
  select(-sub_id)

eli_pol_cor <- cor(eli_wide)

eli_pol_cor_plot <- corrplot(eli_pol_cor, method = "number")

colnames(eli_pol_cor_plot) = rep(c('Politics: Overall',
                                       'Politics: Social',
                                       'Politics: Economic',
                                       'ELI 1',
                                       'ELI 2',
                                       'ELI 3',
                                       'ELI 4',
                                       'ELI 5',
                                       'ELI 6',
                                       'ELI 7',
                                       'ELI 8',
                                       'ELI 9',
                                       'ELI 10'))

rownames(eli_pol_cor_plot) = rep(c('Politics: Overall',
                                       'Politics: Social',
                                       'Politics: Economic',
                                       'ELI 1',
                                       'ELI 2',
                                       'ELI 3',
                                       'ELI 4',
                                       'ELI 5',
                                       'ELI 6',
                                       'ELI 7',
                                       'ELI 8',
                                       'ELI 9',
                                       'ELI 10'))
corrplot(eli_pol_cor_plot, 
         is.corr = TRUE, 
         #method = "number", 
         method = 'color',
         col.lim = c(0, 1),
         tl.cex = .85,
         tl.col = 'black',
         addgrid.col = 'white',
         addCoef.col = 'grey50')
```

Responses on the ELI are not related to responses on the political orientation questions.

Replicate analyses from Pilot using other measures in this doc

# Exploring structure of ELI

## Self

```{r}
eli_wide_self <- clean_data %>% 
  select(sub_id, eli_number, eli_self) %>% 
  unique() %>% 
  pivot_wider(names_from = eli_number, values_from = eli_self) %>% 
  select(sub_id, "1":"10") %>% 
  unique() %>% 
  select(-sub_id)

eli_self_matrix_cor <- cor(eli_wide_self)

eli_self_cor_plot <- corrplot(eli_self_matrix_cor, method = "number")
```

Pretty uncorrelated, makes them appear orthogonal

## Target

```{r}
eli_wide_targ <- clean_data %>% 
  select(sub_id, eli_number, eli_targ) %>% 
  unique() %>% 
  pivot_wider(names_from = eli_number, values_from = eli_targ) %>% 
  select(sub_id, "1":"10") %>% 
  unique() %>% 
  select(-sub_id)

eli_targ_matrix_targ <- cor(eli_wide_targ)

eli_targ_cor_plot <- corrplot(eli_targ_matrix_targ, method = "number")
```

The target has some slightly higher correlations than the self, but highestbeing .31, so still not very high...

## Stereo

```{r}
eli_wide_stereo <- clean_data %>% 
  select(sub_id, eli_number, eli_stereo) %>% 
  unique() %>% 
  pivot_wider(names_from = eli_number, values_from = eli_stereo) %>% 
  select(sub_id, "1":"10") %>% 
  unique() %>% 
  select(-sub_id)

eli_stereo_matrix_stereo <- cor(eli_wide_stereo)

eli_stereo_cor_plot <- corrplot(eli_stereo_matrix_stereo, method = "number")

```

Again, higher correlations than for the self, but still only .35 as the highest.

# Exploring ICC

## BFI

```{r}
mod_1_data_bfi <- clean_data %>% 
  select(sub_id, bfi_number, bfi_targ, bfi_targ_pmc, bfi_self, bfi_self_pmc, itt_comp_gmc, 
         target_condition, bfi_stereo) %>% 
  unique() %>% 
  na.omit() 


#simple linear model to see if school association leads to too high of an ICC
icc_mod_bfi <- lm(bfi_targ_pmc ~ bfi_self_pmc, data = mod_1_data_bfi)

#getting anova results of simple linear model from earlier
icc_mod_res_bfi = anova(icc_mod_bfi)

ICC_bfi = icc_mod_res_bfi$`Sum Sq`[1] / sum(icc_mod_res_bfi$`Sum Sq`)
ICC_bfi #The ICC is tiny - is this why I am getting a singular analysis?
```

## ELI

```{r}
mod_1_data_eli <- clean_data %>% 
  select(sub_id, eli_number, eli_targ_pmc, eli_self_pmc, itt_comp_gmc,
         target_condition) %>% 
  unique() %>% 
  na.omit() 

#simple linear model to see if school association leads to too high of an ICC
icc_mod_eli <- lm(eli_targ_pmc ~ eli_self_pmc, data = mod_1_data_eli)

#getting anova results of simple linear model from earlier
icc_mod_res_eli = anova(icc_mod_eli)

ICC_eli = icc_mod_res_eli$`Sum Sq`[1] / sum(icc_mod_res_eli$`Sum Sq`)
ICC_eli #The ICC is tiny - is this why I am getting a singular analysis?
```


Low ICC could be to blame.

# Checking mean/sd of bfi_self responses per item

```{r}
bfi_wide_self <- clean_data %>% 
  select(sub_id, bfi_number, bfi_self) %>% 
  unique() %>% 
  pivot_wider(names_from = bfi_number, values_from = bfi_self) %>% 
  select(sub_id, "1":"19") %>% 
  unique()

psych::describe(bfi_wide_self)
```

